# 강의요약

### Camera model
* 자율주행에서 Perception은 주행환경을 인지(인식+이해)하는 과정으로, 유의미한 정보를 생성하는 단계가 필요
* Vision의 경우, 이미지 영역에서 객체를 인식하는 것이 아닌 객체와 차량의 관계를 파악하는게 중요하다.
* 사람은 거리에 대한 판단이 되지만, 컴퓨터는 x,y좌표로 가까이있는지 멀리있는지 판단할 수 없음.
* 3차원의 위치 정보를 찾아내는 것이 중요하다. - 3D POSE (position, oriantation) Est를 찾는게 중요하다.

![image](https://user-images.githubusercontent.com/55529455/166864181-80652b7a-61eb-4420-9012-6be942196785.png)
* 3D POSE Estimation의 기본적인 Vision 기술을 소개한다.
* Vision Geometry의 기본적인 지식을 학습한다.

![image](https://user-images.githubusercontent.com/55529455/166864477-6b948b91-f66e-415a-b182-f10e3c5fb56e.png)
* 카메라는 3차원 공간인 세상에 존재하는 대상을 2차원 공간인 이미지 평면에 투영하는 센서다.
* 카메라 모델은 카메라의 투영 과정을 수학적 모델로 표현한 것이다.
* 사람은 공간감이 뛰어나기 때문에 사진을 보고 어떤 객체가 가까이있고 멀리 있는지 안다.
* 사람은 매우 뛰어난 카메라 2개와 컴퓨터 1대를 가지고 있다. (Computer vision의 꽃 camera geometry에 관한 이야기)
* 따라서, 직관적으로 이미지로 다양한 추론이 가능함. (이미지를 보고 어느지점이 가깝고 먼지 앎, 이미지에서 표현되는 크기는 달라도 실제 크기는 동일하다는 것을 앎)
* 소실점 - 원근법에 의해 평행선이 합쳐지는 구간
* 소실선 - 소실점들의 집합
* 3차원 공간 뒤에 사과가 있을 때, 사람의 눈에 사과가 보이는 것은 사과로부터 반사되는 빛이 눈에 들어오기 때문임.
* 실제로는 비츤 수많은 곳에서 출발하고, 난반사 함.
* 카메라는 3차원 공간에 존재하는 물체에 반사된 빛을 기록하는 장치임.
* 미세한 위치에 무한에 가까운 난반사 빛을 카메라에 입력하면 어떻게 될까? - 사과가 아닌 이상한 이미지(빨간 사각형)가 만들어짐
* 사과를 찍으면 사과 그림이 출력되는 이유 - 빛이 들어오는 구멍을 아주 작게 만들어(pinhole) 난반사된 빛이 들어오지 못하도록 함.
* 그래서 동일한 크기의 물체여도, 가까이서 찍으면 크게 보이고, 멀리서 촬영하면 작게 보임 - 반사된 빛과 pinhole의 관계가 달라지기 때문

![image](https://user-images.githubusercontent.com/55529455/166865891-308828fb-fdcb-419a-875e-f730045621e5.png)
* 이미지 좌표 = Intrinsic * extrinsic = obj 위치
* s = 카메라의 scale
* intrinsic - 카메라 자체의 특성
* extrinsic - 카메라와 대상과의 관계 (rotation r, transration t - 회전과 평행이동)

![image](https://user-images.githubusercontent.com/55529455/166866318-01eb9bcd-f629-4056-a861-4abc76ddb898.png)

### Camera Intrinsic Calibration
* Camera Calibration은 카메라가 가지고 있는 고유한 특성을 파악하는 과정
* 카메라는 Camera Project Matrix에 의해 두가지 종류의 고유한 특성을 가짐
* Intrinsic(내부) = 카메라의 내부적인 특성(렌즈와 이미지 센서와의 관계로부터 파생되는 초점거리 등)
* Extrinsic(외부) = 카메라가 대상을 촬영했을 당시의 위치와 자세에 관한 특성 (위로 찍거나, 아래로 찍거나..)
* 그렇다면 왜 내부와 외부 두가지 특성으로 구분할까?
* Intrinsic = 동일한 위치에서 서로 다른 카메라로 동일한 피사체를 촬영하면 그 결과가 다름.
* Extrinsic = 같은 카메라로 서로 다른 위치에서 동일한 피사체를 촬영하면, 그 결과가 다름.
* 초점 거리가 클수록 피사체를 크게 촬영할 수 있음.
* Intrinsic Calibaration은 초점거리 (fx, fy)와 주점(cy, cx)를 의미함.
* 초점 거리 - Pinhole Camera Model에서 말하는 초점거리는 PinHole부터 이미지가 맺히는 벽까지의 거리를 의미함. (focal length)
* 카메라에서 Pinhole은 렌즈를, 벽은 이미지 센서를 의미함.
* 렌즈의 모양에 따라서 이미지가 달라짐. - 선명한 이미지를 얻기 위해서는 초점거리와 렌즈의 모양에 신경써야함.
* 초점거리에 따라 피사체를 축소/확대한 것과 같이 촬영 할 수 있음.
* 실제 이미지는 2차원 평면이기 때문에, 아래 그림에 나타난 초점거리는 한 축에 대한 초점거리를 의미
* Computer Vision에서는 초점 거리는 pixel 단위로 표현이 됨.
* 카메라에서는 초점거리를 실제 물리단위인 mm로 표현 함 - 이미지 센서와 렌즈 중심사이의 거리
* 하지만 Computer Vision에서는 이미지센서의 Cell 크기에 대한 상대적인 Pixel 단위로 표현함.
* 만약 이미지 센서 Cell 크기가 0.1mm이고, f = 500pixel이면, 이미지 센서와 렌즈 중심과의 거리는 Cell 크기의 500배, 50mm를 의미함.
* 이는 이미지 해상도에 따라 초점 거리가 달라지는 이유이기도 함 - 이미지 Cell의 크기에 대한 상대적인 단위기 때문.
* ex) 100x100 cell size(0.1mm), 100x100 image resolution, 1x1 cell이 하나의 Pixel을 나타냄. 따라서 0.1mm * focal length(pixel) = focal length(mm)
* ex) 100x100 cell size(0.1mm), 50x50 image resolution, 2x2 cell이 하나의 Pixel을 나타냄. 따라서 0.2mm * focal length(pixel) = focal length(mm)
* 초점거리와 더불어 Intrinsic Calibiration은 주점(principal Point, cy, cx)이 존재한다.
* 주점은 Pinhole이 이미지 센서에 직교하는 위치를 의미함.
* 주점(Principal Point)과 이미지의 중심점(Center Point)은 다름.
* 주점(=렌즈 중심점)이 이미지 중심점과 일치하는 경우가 이상적, (카메라 제조공정에서 발생하는 다양한 이슈로 안됨.)

![image](https://user-images.githubusercontent.com/55529455/166880413-104d4058-832f-4b26-b758-2582e362432c.png)

```
* 월드 좌표계 - Xw, Yw, Zw
* 카메라 좌표계 - Xc, Yc, Zc
* 이미지 좌표계 - u, v
* 정규 이미지 좌표계 - un, vn
```
* 월드 좌표계는 우리가 살고있는 3차원 공간에 존재하는 좌표
* 따라서 임의의 한 점을 기준으로 좌표계를 설정할 수 없음.
* 월드 좌표계를 기준으로 어떤 물체의 위치를 표현할 수 있다. Pw = (Xw0, Yw0, Zw0)
* 월드 좌표계를 기준으로 카메라의 위치를 표현할 수 있다.

![image](https://user-images.githubusercontent.com/55529455/166893860-46d3f96e-5355-40a1-a999-da5328503c66.png)

* 카메라 좌표계는 카메라를 기준으로 표현하는 좌표계
* 카메라를 기준으로 설정하는 좌표는 다음과 같다.
* 카메라 렌즈가 바라보고 있는 방향 Zc, 카메라 아래쪽 방향 Xc, 카메라 오른쪽 방향 Yc
* 꼭 이렇게 되는 것이 아님. - 종방향 기준이기 때문에 라이브러리 사용 시 확인을 잘 해야함.

* 이미지 좌표계는 실제 이미지로 표출되는 데이터를 표현하고자 하는 좌표계
* 이미지의 왼쪽 상단을 원점으로 함. 오른쪽방향(col)을 x, u라고 함. 아래방향(row)을 y 또는 v라고 함.

* 정규 이미지 좌표계는 실제 존재하지 않는 좌표계로, Computer Vision에서 해석을 위해 정의한 가상의 좌표계
* 렌즈로부터 이미지 평면까지의 거리를 초점거리라고 정의하였음
* 같은 물체를 동일한 위치에서 서로 다른 카메라로 촬영할 경우, 이미지에서 다르게 표현됨.
* 카메라마다 초점거리가 다르기 때문에 이미지 좌표계에서 다른 위치에 존재함.
* 따라서 초점거리를 1로 정규화 한 가상의 이미지 좌표계를 사용함. - 초점거리에 대한 영향을 제거함.

* 정규 이미지 좌표계와 이미지 좌표계의 차이
* 이미지 좌표계 - 카메라 원점으로부터 초점거리만큼 떨어져있는 이미지 평면
* 정규 이미지 좌표계 - 카메라 원점으로부터 1만큼 떨어져 있는 가상의 이미지 평면

![image](https://user-images.githubusercontent.com/55529455/166896016-28770728-7f57-4e91-beb5-6e8387936a3c.png)

### Distortion (왜곡)
* 실제 카메라에는 Pinhole Camera Model에서 작은 구멍이 아닌, 렌즈로 빛을 모은다
* 작은 구멍(pinhole) - 렌즈, 이미지가 맺히는 벽 - 이미지 센서
* 완벽한 Pinhole 카메라는 빛이 하나의 점을 통과하지만, 렌즈는 크기를 가지는 물체이기 때문에 빛이 굴절됨
* 빛의 굴절은 이미지 센서에 보이는 이미지를 왜곡한다.
* 왜곡은 렌즈 형상이 곡률을 가지는 구면형태이기 때문에 나타남
* 따라서 이미지 중심부(주점, Principal Point)에서 멀어질수록 표현의 비율이 달라지기 때문에 발생함.
* PD - Predicted Distance, AD - Actual Distance 일때, D(%) = (AD - PD) / PD * 100

* 방사왜곡은 대표적인 두가지 형태로 표현됨.
* Barrel Distortion - 중심부가 외각부보다 큰 형태로 발생
* Pincushion Distance - 중심부가 외각부보다 작은 형태로 발생
* 방사 왜곡은 이미지의 중심으로부터 멀어질수록 왜곡의 정도가 심해짐.

* 또 다른 왜곡으로는 접선 왜곡이 있다.
* 접선 왜곡은 카메라 제조공정에서 발생하는 왜곡, 렌즈와 이미지 센서의 수평이 맞지 않을 때 발생함.
* 접선 왜곡은 타원 형태로 발생하는 왜곡으로 방사왜곡과는 다르게 표현됨.

* 다른 다양한 형태의 왜곡이 존재함. - 원근 왜곡이 있다.
* 방사 왜곡과 접선 왜곡이 광학의 원리와 카메라에서 발생하는 왜곡이라면 원근 왜곡은 3차원 공간이 2차원 공간으로 투영되면서 발생되는 왜곡
* 이미지는 공간의 깊이 정보가 하나의 평면으로 투영되는 데이터이기 때문에, 이미지를 촬영하는 환경에 따라 다양한 왜곡이 만들어질수도, 만들어질 수 있다.
* 원근감 손실을 표현 할 수 있는 수단이 없기 때문에 발생함.
* 사물의 실제 크기, 사물과 주변의 관계, 추정이 기하학 구조로 인해서 사람은 추적할 수 있지만, 컴퓨터는 유사한 방법을 이용하여 3D Vision으로 연구중.

![image](https://user-images.githubusercontent.com/55529455/166899917-f91ddb78-3773-4c5b-9ed5-79ec44105eec.png)
![image](https://user-images.githubusercontent.com/55529455/166900013-8ec78172-0afd-4fa1-9d21-cddf947b6250.png)

* 컴퓨터 비전에서의 왜곡은 이미지의 기하학적 정보를 해석하는데 방해요소기 때문에, 왜곡을 보정하여 사용함.

![image](https://user-images.githubusercontent.com/55529455/166901107-e35dad5c-dadc-4f3f-bdb0-1489eddab5b1.png)
![image](https://user-images.githubusercontent.com/55529455/166901619-29e2633e-96e1-4856-b084-f179fe7ba5a2.png)
![image](https://user-images.githubusercontent.com/55529455/166902087-d02af0f0-6062-423a-bc21-a681b9991ec1.png)



















