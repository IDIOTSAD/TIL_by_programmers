# 강의 요약
## Least squares - 최소자승법
* 다시 SLAM의 정의로.. - 동시적 위치 추정 지도 작성 (기존의 로컬라이제이션, 매핑 기술과 다르게 최적의 값을 두가지를 동시에 계산)
* 최적화 - 방정식에서 완벽하게 떨어지는 값을 찾지 못할 때, 가장 적은 에러를 가지는 값을 찾는 수학적 기법.
* 최소자승법은 SLAM에서 사용할 최적화 방법.
* 에러 값을 제곱하여 에러로 취급함. 비교적 높은 값을 가지는 에러는 더 큰 에러를 가지게 됨.
* 제곱값이 최소 값이 되는 방법을 이용함.
* over-determined system임. - 미지수의 개수보다 방정식의 개수가 많음.
* 왜냐하면, 풀려고 하는 state의 개수보다(랜드마크의 수, 카메라 pose) 센서 데이터가 더 많기 때문이다.
* x = state, z = 센서 값, f(x) = state를 통해서 추정된 z가 나오는 수식, z^ = 추정된 센서 값
* z와 z^의 값은 차이가 있음. - 모델링 에러 및 노이즈때문에. -> 해당 차이가 에러라고 볼 수 있음.
* 모든 에러의 값들의 합이 최소화가 되는 x의 값이 무엇인지 찾는 것이다.

![image](https://user-images.githubusercontent.com/55529455/171386839-f0f7d3a4-bc90-49df-bb28-dcf6cf11920f.png)


## Maximum-a-posteriori (MAP) estimation in SLAM - 최대사후확률이 슬램에 어떻게 적용?
* sensor measurment 2가지
* proprioceptive senseing, Exteroceptive sensing
---
* proprioceptive senseing
* x(k-1) - 이전 프레임의 상태
* uk - 컨트롤, 오도메트리(이전 상태와 현재 상태의 위치 차이) - 컨트롤의 경우, 제어의 관점으로 전방으로 5m 측량관점의 경우, 오도메트리 센서가 5m 움직였다고 했을때
* eu - 모션 노이즈 (노이즈라고 보면 됨.)
* 현재 프레임의 상태는 이전 프레임의 상태에서 이동치를 더하고, 노이즈를 더한 것.

![image](https://user-images.githubusercontent.com/55529455/171389516-df0ed770-cc45-48e5-adfd-b0683a9582d0.png)

---
* Exteroceptive sensing
* 랜드마크에 위치에 관한 상태를 추정할 수 있는 수식
* xk - 현재 로봇의 상태
* li - 랜드마크들의 상대적인 위치
* ez - 노이즈
* distance는 간단하게 피타고라스 정리로 풀어냄.
* bearing은 x값 y값의 거리를 구하고, 아크탄젠트로 방향을 구함. 현재 방향의 각도를 빼줌 로봇과 랜드마크의 상대적인 변화를 구함.

![image](https://user-images.githubusercontent.com/55529455/171390031-1588bbc6-55aa-415a-8e94-041947e33933.png)

---
* 한개의 모션 상태와 다수의 랜드마크 상태가 출력
* 시간이 지나면서 움직이면서 pose가 바뀌고, 랜드마크의 관측값도 바뀜. - SLAM state가 더 생김
* 잘 분석해서 로봇 pose와 랜드마크 상태를 구하는것이 SLAM

![image](https://user-images.githubusercontent.com/55529455/171390601-8ca1b833-a128-4989-8dc2-d26dab3eb8b6.png)

* 어쩔 수 없이 시간이 지날수록 노이즈가 쌓임.
* 이를 해결하기 위해서 루프 클로저 알고리즘을 사용함.
* 노이즈 패턴을 분석하면서 가장 최적의 랜드위치 값, 로봇 pose 값을 찾으려 한다.
* 이를 통계적으로 얘기하면, belief라고 함.
* 과거의 통계는 어떠고, 최적의 파라메터가 무엇이 되어야 최적의 값인지 유추하는 것.
* 로봇 pose, 랜드마크위치 값은 사후 데이터이기 때문에, 최대 사후 확률을 구하는 문제를 풀게 되는 것이다.
* MAT를 풀기위해서는 모션, 옵서베이션 모델의 확률 분포를 잡고 확률 분포를 정확하게 표현하는 상태를 찾는 것이 목적
---
![image](https://user-images.githubusercontent.com/55529455/171399611-27667706-061b-42ce-97a3-70c1477afbc0.png)
* 0에 수렴한다고 생각 할 때, 노이즈가 없다고 생각하게 됨. 이를 왼쪽으로 옮긴다.
* 다른 해석으로 보면, xk - f(xk-1, uk)가 e와 동일하게 되는 것이다 라고 볼 수 있다.
* 마찬가지로 아래내용도 비슷하게 됨.
* 왼쪽 시그마 - 모델 에러값, 오른쪽 시그마 - 옵서베이션 에러값
---
* 모델 에러값만 최적화 했을 때, 이를 통해서 tansepose를 그릴 수 있게 됨.
* 각각 로봇 pose의 옵서베이션을 보고 랜드마크 위치를 그리면 서로 동일하지 못하는 상황이 나옴.
* 로컬라이제이션하는데 맵이 부족하거나 매핑하는데 모션이 부족하면 이러한 그림이 나오기도 함.
![image](https://user-images.githubusercontent.com/55529455/171399766-f28056ef-6053-498a-bd32-dbd9a261b493.png)
* 모델에러 + 옵서베이션 에러값을 최적화 했을 때, 다음과 같은 그림이 됨.
* 최소화된 에러를 가지는 파라메터 (상태)를 계산함.
* 여러개의 함수를 한번에 최적화 해서 상태를 구하는것을 조인트 옵티마이제이션이라고 함.
* 여기서 SLAM의 핵심이 나온다. - 동시적 위치추정 및 지도 작성
![image](https://user-images.githubusercontent.com/55529455/171399950-51a52594-00a1-40f8-be94-6aec5afc2a5a.png)

## Graph-based SLAM - 그래프 기반 슬램
* SLAM의 2가지 방법
* 1. Incremental SLAM - 필터 기반 알고리즘 사용, 파티클 필터, 익스텐드 칼만 필터
* 2. Batch SLAM - 오프라인 슬램이라고도 함. 그래프 최적화 알고리즘.
---
* Incremental SLAM은 가장 최종의 상태만 추정하는 것이 특징임.
* 이전 상태의 정보는 새로운 정보에 영향을 준다.
* 이전의 상태, 컨트롤 입력, 옵서베이션 정보만 있어도 되므로 빠르게 계산이 되는 장점이 있음.
* 최신 정보를 주기 때문에 과거에는 실시간 사용가능하므로 온라인 SLAM이라고도 함.

![image](https://user-images.githubusercontent.com/55529455/171407945-a55c0f98-8b12-4277-8c61-d8ef0b0a2db7.png)

---
* Batch SLAM - 여러시점의 상태를 한꺼번에 추론함.
* 동시에 여러 정보를 독립적으로 추론하기 때문에, 드리프트 에러는 잘 해결됨.
* 하지만, 그만큼 많은 정보를 하므로 계산량이 많아짐.
* 실시간 처리가 불가능하다는 의미로 오프라인 SLAM이라고도 불림.
* 요즘은 방법을 이용해 온라인에서도 사용가능.

![image](https://user-images.githubusercontent.com/55529455/171408291-aba02dce-28d5-4829-aa9d-804cd52b0581.png)

---
* Incremental SLAM은 빠르지만, Batch SLAM보다 부정확하다.
* 2012년에 발표한 V-SLAM by filter에 따르면, 동일한 계산을 수행한다면, Batch SLAM이 Incremental SLAM보다 더 정확하다는 논문이 나옴.
* 그 후로, V-SLAM은 Batch SLAM 방식을 사용하게 됨.
* 현재로서는 Factor SLAM으로 이루어지게 되었음.
* Factor SLAM은 노드와 그래프로 이루어진 SLAM
* 노드에는 로봇 state, 랜드마크 state 저장
* 엣지에는 모션, 옵서베이션 정보가 저장됨. (Factor)
* 그래프를 최적? - 모션 모델과 옵서베이션 모델을 이용하여 최적화 한다는 것 - 직관적 구조로 SLAM에서 가장 유명한 그래프 표현 방식
---
* 그래프로 표현됨으로써 - 엣지를 통해 모션, 옵서베이션 링크를 쉽게 파악을 할 수 있게 됨.
* 이를 이용해서 그래프 루프가 생긴 경우, 그래프 최적화를 통해서 누적된 언설턴티를 제거해주고, 루프 안에 노드들에 대한 포즈와 랜드마크포즈의 최적값을 찾을 수 있게 됨.
* 루프 클로저 기술로 인해서 테이블이나 방에서 사용할 수 있었던 기술이 매우 크게 볼 수 있게 됨. (노이즈를 쉽게 잡을 수 있게 됨)
* SLAM에서도 파이프라인이 생김. - 프론트엔드에서는 그래프의 노드와 엣지를 추가해주는 작업, 백엔드 - 루프클로저가 생기거나 트리거가 되는 그래픽 최적화 알고리즘 수행
* V-odometry - 누적된 드리프트를 제거 할 수 있는 방법, 글로벌 스케일로서 그래프 옵티마이저가 불가능
* V-SLAM - 반대로 있다.













